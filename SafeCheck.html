<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>8 February 2027's Call - SafeCheck</title>

    <!-- Icône de la page -->
    <link rel="icon" type="image/png" href="827scall Logo (Carré).png">

    <!-- Police titres : Inndam Extended (à remplacer par ta vraie fonte / @font-face) -->
    <style>
        /* =========================
           FONTS
           ========================= */
        @font-face {
            font-family: 'Inndam Extended';
            src: url('InndamExtended.woff2') format('woff2'),
                 url('InndamExtended.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --bg-color: #050608;
            --bg-panel: #0b0d10;
            --bg-panel-alt: #10131a;
            --border-color: #22252e;
            --accent: #00ff9c;
            --accent-soft: #00c77a;
            --accent-warning: #ffd54a;
            --accent-danger: #ff3b3b;
            --accent-danger-strong: #ff0000;
            --accent-unknown: #ff9800;
            --accent-safe: #4caf50;
            --accent-normal: #ffc107;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --text-soft: #6b7280;
            --scan-safe: #4caf50;
            --scan-normal: #ffc107;
            --scan-danger: #ff5252;
            --scan-virus: #ff0000;
            --scan-unknown-normal: #ff9800;
            --scan-unknown-suspect: #ff9800;
            --shadow-soft: 0 0 0 1px rgba(255,255,255,0.02), 0 18px 45px rgba(0,0,0,0.75);
            --radius-lg: 18px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --transition-fast: 0.18s ease-out;
            --transition-med: 0.28s ease-out;
            --transition-slow: 0.45s ease-out;
            --font-title: 'Inndam Extended', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-base: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top, #151821 0, #050608 55%, #020308 100%);
            color: var(--text-main);
            font-family: var(--font-base);
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        body {
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        /* =========================
           LAYOUT GLOBAL
           ========================= */

        .app-root {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px 20px 32px;
            position: relative;
        }

        @media (min-width: 1024px) {
            .app-root {
                padding: 32px 24px 40px;
            }
        }

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
            gap: 16px;
        }

        .app-header-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .app-logo {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.8), 0 10px 30px rgba(0,0,0,0.9);
            background: radial-gradient(circle at 30% 0, #ffffff 0, #d1d5db 18%, #111827 60%, #020617 100%);
        }

        .app-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .app-title-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .app-title {
            font-family: var(--font-title);
            font-size: 18px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: #f9fafb;
        }

        .app-subtitle {
            font-size: 11px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--text-soft);
        }

        .app-header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .pill {
            border-radius: 999px;
            padding: 4px 10px;
            border: 1px solid rgba(148,163,184,0.35);
            background: radial-gradient(circle at top left, rgba(148,163,184,0.25), rgba(15,23,42,0.9));
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .pill-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: var(--accent);
            box-shadow: 0 0 12px rgba(34,197,94,0.9);
        }

        .pill-label {
            text-transform: uppercase;
            letter-spacing: 0.16em;
            font-size: 10px;
        }

        .pill-label-weak {
            text-transform: uppercase;
            letter-spacing: 0.16em;
            font-size: 10px;
            color: var(--text-soft);
        }

        /* =========================
           INTRO / TERMINAL ANIM
           ========================= */

        .intro-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, #020617 0, #020617 40%, #000000 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
            pointer-events: auto;
            transition: opacity var(--transition-slow), visibility var(--transition-slow);
        }

        .intro-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .intro-terminal {
            width: min(640px, 92vw);
            background: #020617;
            border-radius: 18px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(148,163,184,0.35);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .intro-terminal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: radial-gradient(circle at top left, #111827, #020617);
            border-bottom: 1px solid rgba(31,41,55,0.9);
        }

        .intro-terminal-dots {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .intro-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: #4b5563;
        }

        .intro-dot.red {
            background: #f87171;
        }

        .intro-dot.yellow {
            background: #facc15;
        }

        .intro-dot.green {
            background: #4ade80;
        }

        .intro-terminal-title {
            font-size: 11px;
            color: var(--text-soft);
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .intro-terminal-body {
            padding: 18px 18px 20px;
            font-family: var(--font-base);
            font-size: 13px;
            color: var(--text-main);
            background: radial-gradient(circle at top left, #020617, #020617 40%, #020617 100%);
            position: relative;
            overflow: hidden;
        }

        .intro-main-line {
            font-size: 26px;
            line-height: 1.3;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: #e5e7eb;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            border-right: 2px solid var(--accent);
            animation: typing 1.8s steps(18, end), caret 0.8s step-end infinite;
        }

        .intro-main-line span.accent {
            color: var(--accent);
        }

        .intro-sub-line {
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--text-soft);
            margin-bottom: 14px;
        }

        .intro-log {
            font-size: 12px;
            color: var(--text-soft);
            line-height: 1.5;
            max-height: 160px;
            overflow: hidden;
        }

        .intro-log-line {
            opacity: 0;
            transform: translateY(4px);
            animation: introLineIn 0.4s ease-out forwards;
        }

        .intro-log-line:nth-child(1) { animation-delay: 0.6s; }
        .intro-log-line:nth-child(2) { animation-delay: 1.0s; }
        .intro-log-line:nth-child(3) { animation-delay: 1.4s; }
        .intro-log-line:nth-child(4) { animation-delay: 1.8s; }
        .intro-log-line:nth-child(5) { animation-delay: 2.2s; }

        .intro-log-prefix {
            color: var(--accent-soft);
        }

        .intro-progress-bar {
            margin-top: 14px;
            width: 100%;
            height: 4px;
            border-radius: 999px;
            background: #020617;
            overflow: hidden;
            border: 1px solid rgba(31,41,55,0.9);
        }

        .intro-progress-inner {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-soft), var(--accent));
            animation: introProgress 2.8s ease-out forwards;
        }

        .intro-skip {
            position: absolute;
            right: 14px;
            bottom: 10px;
            font-size: 10px;
            color: var(--text-soft);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.4);
            background: rgba(15,23,42,0.9);
            backdrop-filter: blur(6px);
            transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
        }

        .intro-skip:hover {
            background: rgba(15,23,42,1);
            color: #e5e7eb;
            border-color: rgba(209,213,219,0.9);
            transform: translateY(-1px);
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes caret {
            0%, 50% { border-color: var(--accent); }
            50.01%, 100% { border-color: transparent; }
        }

        @keyframes introLineIn {
            from {
                opacity: 0;
                transform: translateY(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes introProgress {
            from { width: 0%; }
            to { width: 100%; }
        }

        /* =========================
           CONTENU PRINCIPAL
           ========================= */

        .app-main {
            display: grid;
            grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
            gap: 18px;
            align-items: flex-start;
        }

        @media (max-width: 960px) {
            .app-main {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .panel {
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(3,7,18,0.98));
            border-radius: var(--radius-lg);
            border: 1px solid rgba(31,41,55,0.9);
            box-shadow: var(--shadow-soft);
            padding: 16px 16px 18px;
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(56,189,248,0.06), transparent 55%);
            opacity: 0.7;
            pointer-events: none;
        }

        .panel-inner {
            position: relative;
            z-index: 1;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            gap: 10px;
        }

        .panel-title-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .panel-title {
            font-family: var(--font-title);
            font-size: 14px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: #f9fafb;
        }

        .panel-subtitle {
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--text-soft);
        }

        .panel-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.5);
            color: var(--text-soft);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.95));
        }

        .panel-section {
            margin-top: 10px;
        }

        .panel-section-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
            margin-bottom: 6px;
        }

        .panel-section-label span {
            color: var(--accent-soft);
        }

        .panel-section-description {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        /* =========================
           FORMULAIRE SAFE CHECK
           ========================= */

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        .input-label-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .input-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .input-label span {
            color: var(--accent-soft);
        }

        .input-hint {
            font-size: 11px;
            color: var(--text-soft);
        }

        .textarea-shell {
            position: relative;
            border-radius: var(--radius-md);
            border: 1px solid rgba(55,65,81,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
            overflow: hidden;
        }

        .textarea-shell::before {
            content: ">";
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 12px;
            color: var(--accent-soft);
            opacity: 0.9;
        }

        textarea#linkInput {
            width: 100%;
            min-height: 110px;
            max-height: 220px;
            padding: 10px 10px 10px 22px;
            border: none;
            outline: none;
            resize: vertical;
            background: transparent;
            color: var(--text-main);
            font-family: var(--font-base);
            font-size: 13px;
            line-height: 1.5;
        }

        textarea#linkInput::placeholder {
            color: var(--text-soft);
        }

        .file-drop {
            position: relative;
            border-radius: var(--radius-md);
            border: 1px dashed rgba(75,85,99,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.85), rgba(15,23,42,0.98));
            padding: 12px 12px 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            cursor: pointer;
            transition: border-color var(--transition-fast), background var(--transition-fast), transform var(--transition-fast);
        }

        .file-drop:hover {
            border-color: rgba(148,163,184,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
            transform: translateY(-1px);
        }

        .file-drop-icon-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .file-drop-icon {
            width: 18px;
            height: 18px;
            border-radius: 6px;
            border: 1px solid rgba(148,163,184,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: var(--accent-soft);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
        }

        .file-drop-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .file-drop-hint {
            font-size: 11px;
            color: var(--text-soft);
        }

        .file-drop input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .file-selected {
            font-size: 11px;
            color: var(--accent-soft);
        }

        .file-selected strong {
            font-weight: 600;
        }

        .actions-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }

        .actions-left {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .latency-pill {
            border-radius: 999px;
            padding: 3px 8px;
            border: 1px solid rgba(148,163,184,0.5);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .latency-pill span {
            color: var(--accent-soft);
        }

        .actions-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            border-radius: 999px;
            padding: 7px 14px;
            border: 1px solid rgba(148,163,184,0.6);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
            color: var(--text-main);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), color var(--transition-fast);
        }

        .btn span.icon {
            font-size: 12px;
        }

        .btn-primary {
            border-color: rgba(34,197,94,0.9);
            background: radial-gradient(circle at top left, rgba(22,163,74,0.9), rgba(5,46,22,1));
            color: #ecfdf5;
            box-shadow: 0 0 0 1px rgba(22,163,74,0.4), 0 12px 30px rgba(22,163,74,0.45);
        }

        .btn-primary:hover {
            background: radial-gradient(circle at top left, rgba(22,163,74,1), rgba(4,120,87,1));
            border-color: rgba(187,247,208,1);
            transform: translateY(-1px);
            box-shadow: 0 0 0 1px rgba(22,163,74,0.6), 0 16px 40px rgba(22,163,74,0.6);
        }

        .btn-ghost {
            background: transparent;
            border-style: dashed;
            color: var(--text-soft);
        }

        .btn-ghost:hover {
            background: rgba(15,23,42,0.9);
            color: var(--text-main);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: default;
            transform: none;
            box-shadow: none;
        }

        /* =========================
           STATUTS & RÉSULTATS
           ========================= */

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border-radius: 999px;
            padding: 4px 10px;
            border: 1px solid rgba(148,163,184,0.6);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--text-soft);
            box-shadow: 0 0 10px transparent;
        }

        .status-chip.safe .status-dot {
            background: var(--scan-safe);
            box-shadow: 0 0 12px rgba(74,222,128,0.9);
        }

        .status-chip.normal .status-dot {
            background: var(--scan-normal);
            box-shadow: 0 0 12px rgba(250,204,21,0.9);
        }

        .status-chip.danger .status-dot {
            background: var(--scan-danger);
            box-shadow: 0 0 12px rgba(248,113,113,0.9);
        }

        .status-chip.virus .status-dot {
            background: var(--scan-virus);
            box-shadow: 0 0 14px rgba(248,113,113,1);
        }

        .status-chip.unknown-normal .status-dot {
            background: var(--scan-unknown-normal);
            box-shadow: 0 0 12px rgba(251,146,60,0.9);
        }

        .status-chip.unknown-suspect .status-dot {
            background: var(--scan-unknown-suspect);
            box-shadow: 0 0 14px rgba(251,146,60,1);
        }

        .status-chip-label {
            color: var(--text-soft);
        }

        .status-chip-value {
            color: #e5e7eb;
        }

        .status-chip-risk {
            font-weight: 600;
        }

        .status-chip-risk.safe {
            color: var(--scan-safe);
        }

        .status-chip-risk.normal {
            color: var(--scan-normal);
        }

        .status-chip-risk.danger {
            color: var(--scan-danger);
        }

        .status-chip-risk.virus {
            color: var(--scan-virus);
        }

        .status-chip-risk.unknown-normal {
            color: var(--scan-unknown-normal);
        }

        .status-chip-risk.unknown-suspect {
            color: var(--scan-unknown-suspect);
        }

        .blink-red {
            animation: blinkRed 0.36s step-end infinite;
        }

        .blink-orange {
            animation: blinkOrange 0.36s step-end infinite;
        }

        @keyframes blinkRed {
            0%, 50% { opacity: 1; }
            50.01%, 100% { opacity: 0.25; }
        }

        @keyframes blinkOrange {
            0%, 50% { opacity: 1; }
            50.01%, 100% { opacity: 0.25; }
        }

        .results-panel {
            margin-top: 10px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(55,65,81,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
            padding: 10px 10px 10px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .results-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
            gap: 8px;
        }

        .results-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .results-body {
            max-height: 220px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .results-item {
            border-radius: 10px;
            border: 1px solid rgba(55,65,81,0.9);
            padding: 8px 9px;
            margin-bottom: 6px;
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
        }

        .results-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 4px;
        }

        .results-item-label {
            font-size: 11px;
            color: var(--text-soft);
        }

        .results-item-type {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
        }

        .results-item-content {
            font-size: 12px;
            color: var(--text-main);
            word-break: break-all;
        }

        .results-item-meta {
            margin-top: 4px;
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .results-item-meta span {
            white-space: nowrap;
        }

        .results-item-meta strong {
            font-weight: 600;
        }

        .results-empty {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* =========================
           PANNEAU DE DROITE
           ========================= */

        .risk-legend {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 6px;
            margin-top: 8px;
        }

        .risk-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .risk-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: var(--text-soft);
            box-shadow: 0 0 10px transparent;
        }

        .risk-legend-dot.safe {
            background: var(--scan-safe);
            box-shadow: 0 0 12px rgba(74,222,128,0.9);
        }

        .risk-legend-dot.normal {
            background: var(--scan-normal);
            box-shadow: 0 0 12px rgba(250,204,21,0.9);
        }

        .risk-legend-dot.danger {
            background: var(--scan-danger);
            box-shadow: 0 0 12px rgba(248,113,113,0.9);
        }

        .risk-legend-dot.virus {
            background: var(--scan-virus);
            box-shadow: 0 0 14px rgba(248,113,113,1);
        }

        .risk-legend-dot.unknown-normal {
            background: var(--scan-unknown-normal);
            box-shadow: 0 0 12px rgba(251,146,60,0.9);
        }

        .risk-legend-dot.unknown-suspect {
            background: var(--scan-unknown-suspect);
            box-shadow: 0 0 14px rgba(251,146,60,1);
        }

        .risk-legend-label {
            text-transform: uppercase;
            letter-spacing: 0.16em;
        }

        .risk-legend-desc {
            font-size: 11px;
            color: var(--text-soft);
        }

        .scan-steps {
            margin-top: 10px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(55,65,81,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
            padding: 10px 10px 10px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .scan-steps-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-soft);
            margin-bottom: 6px;
        }

        .scan-step {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 4px;
        }

        .scan-step-index {
            font-size: 11px;
            color: var(--accent-soft);
            min-width: 18px;
        }

        .scan-step-body {
            font-size: 12px;
            color: var(--text-muted);
        }

        .scan-step-body strong {
            color: var(--text-main);
        }

        .scan-step-body span {
            color: var(--accent-soft);
        }

        .backend-note {
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .backend-note strong {
            color: var(--accent-soft);
        }

        .backend-note code {
            font-family: var(--font-base);
            font-size: 11px;
            background: rgba(15,23,42,0.9);
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid rgba(55,65,81,0.9);
        }

        /* =========================
           POPUPS / ALERTES
           ========================= */

        .popup-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.72);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-med), visibility var(--transition-med);
        }

        .popup-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .popup {
            width: min(480px, 92vw);
            border-radius: 18px;
            border: 1px solid rgba(55,65,81,0.9);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,1));
            box-shadow: 0 24px 60px rgba(0,0,0,0.9);
            padding: 16px 16px 14px;
            position: relative;
            overflow: hidden;
        }

        .popup::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(248,113,113,0.16), transparent 55%);
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-med);
        }

        .popup-critical::before {
            opacity: 1;
        }

        .popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 8px;
        }

        .popup-title-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .popup-title {
            font-family: var(--font-title);
            font-size: 14px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: #f9fafb;
        }

        .popup-subtitle {
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--text-soft);
        }

        .popup-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            color: var(--text-soft);
            background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,1));
        }

        .popup-badge-danger {
            border-color: rgba(248,113,113,0.9);
            color: #fecaca;
        }

        .popup-badge-critical {
            border-color: rgba(248,113,113,1);
            color: #fee2e2;
            box-shadow: 0 0 0 1px rgba(248,113,113,0.6), 0 0 24px rgba(248,113,113,0.9);
        }

        .popup-body {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .popup-body strong {
            color: var(--text-main);
        }

        .popup-body ul {
            margin: 6px 0 0;
            padding-left: 18px;
        }

        .popup-body li {
            margin-bottom: 3px;
        }

        .popup-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-top: 6px;
        }

        .popup-footer-left {
            font-size: 11px;
            color: var(--text-soft);
        }

        .popup-footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .popup-countdown {
            font-size: 11px;
            color: #fecaca;
        }

        .popup-close {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            background: rgba(15,23,42,0.95);
            color: var(--text-main);
            cursor: pointer;
            transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
        }

        .popup-close:hover {
            background: rgba(15,23,42,1);
            border-color: rgba(209,213,219,0.9);
            transform: translateY(-1px);
        }

        .popup-critical .popup-title {
            color: #fee2e2;
        }

        .popup-critical .popup-subtitle {
            color: #fecaca;
        }

        .popup-critical .popup-body {
            color: #fecaca;
        }

        /* =========================
           FOOTER
           ========================= */

        .app-footer {
            margin-top: 16px;
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .app-footer-left {
            text-transform: uppercase;
            letter-spacing: 0.16em;
        }

        .app-footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-footer-right span {
            white-space: nowrap;
        }

        .app-footer-right code {
            font-family: var(--font-base);
            font-size: 11px;
            background: rgba(15,23,42,0.9);
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid rgba(55,65,81,0.9);
        }

        /* Scrollbar légère */
        .results-body::-webkit-scrollbar {
            width: 6px;
        }

        .results-body::-webkit-scrollbar-track {
            background: rgba(15,23,42,0.9);
        }

        .results-body::-webkit-scrollbar-thumb {
            background: rgba(55,65,81,0.9);
            border-radius: 999px;
        }

        /* =========================
           RESPONSIVE
           ========================= */

        @media (max-width: 640px) {
            .app-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .app-header-right {
                align-self: stretch;
                justify-content: space-between;
            }

            .actions-row {
                flex-direction: column;
                align-items: stretch;
            }

            .actions-right {
                justify-content: flex-end;
            }

            .risk-legend {
                grid-template-columns: minmax(0, 1fr);
            }
        }
    </style>
</head>
<body>

<div class="intro-overlay" id="introOverlay">
    <div class="intro-terminal">
        <div class="intro-terminal-header">
            <div class="intro-terminal-dots">
                <div class="intro-dot red"></div>
                <div class="intro-dot yellow"></div>
                <div class="intro-dot green"></div>
            </div>
            <div class="intro-terminal-title">827 : SafeCheck — boot sequence</div>
        </div>
        <div class="intro-terminal-body">
            <div class="intro-main-line">
                827 : <span class="accent">SafeCheck</span>
            </div>
            <div class="intro-sub-line">
                8 February 2027's Call — Command-line style interface
            </div>
            <div class="intro-log">
                <div class="intro-log-line"><span class="intro-log-prefix">[BOOT]</span> Initialisation du noyau SafeCheck...</div>
                <div class="intro-log-line"><span class="intro-log-prefix">[I/O]</span> Chargement des modules de scan texte &amp; fichiers...</div>
                <div class="intro-log-line"><span class="intro-log-prefix">[LINK]</span> Connexion à l’interface backend (antivirus / sandbox)...</div>
                <div class="intro-log-line"><span class="intro-log-prefix">[SEC]</span> Isolation des liens &amp; fichiers pour analyse hors utilisateur...</div>
                <div class="intro-log-line"><span class="intro-log-prefix">[READY]</span> SafeCheck prêt. Appuyez sur SCAN pour lancer l’analyse.</div>
            </div>
            <div class="intro-progress-bar">
                <div class="intro-progress-inner"></div>
            </div>
            <button class="intro-skip" id="introSkip">SKIP / ENTER</button>
        </div>
    </div>
</div>

<div class="app-root">
    <header class="app-header">
        <div class="app-header-left">
            <div class="app-logo">
                <img src="827scall Logo (Carré).png" alt="827scall Logo">
            </div>
            <div class="app-title-block">
                <div class="app-title">8 February 2027's Call</div>
                <div class="app-subtitle">827 : SafeCheck — AntiPirate / AntiMalware</div>
            </div>
        </div>
        <div class="app-header-right">
            <div class="pill">
                <div class="pill-dot"></div>
                <div class="pill-label">Interface connectable à un backend réel</div>
            </div>
            <div class="pill">
                <div class="pill-label-weak">Mode : <span style="color: var(--accent-soft);">Command-line</span></div>
            </div>
        </div>
    </header>

    <main class="app-main">
        <!-- PANEL GAUCHE : FORMULAIRE & RÉSULTATS -->
        <section class="panel">
            <div class="panel-inner">
                <div class="panel-header">
                    <div class="panel-title-block">
                        <div class="panel-title">SafeCheck</div>
                        <div class="panel-subtitle">Scan de liens &amp; fichiers — 3 étapes</div>
                    </div>
                    <div class="status-chip" id="globalStatusChip">
                        <div class="status-dot"></div>
                        <div class="status-chip-label">Risque global :</div>
                        <div class="status-chip-value status-chip-risk" id="globalRiskLabel">En attente</div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-section-label">
                        Entrée <span>texte</span> &amp; <span>fichier</span>
                    </div>
                    <div class="panel-section-description">
                        Colle un lien suspect ou non, et/ou importe un fichier. SafeCheck analysera :
                        <strong>1) le texte / extension</strong>, <strong>2) le contenu via backend</strong>,
                        <strong>3) l’overall analyse</strong>.
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Zone de texte — liens / URLs</div>
                            <div class="input-hint">Ex : https://google.com, https://facebook.com, liens raccourcis, etc.</div>
                        </div>
                        <div class="textarea-shell">
                            <textarea id="linkInput" placeholder="Colle ici un ou plusieurs liens (un par ligne, ou séparés par des espaces)..."></textarea>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Zone d’importation de fichier</div>
                            <div class="input-hint">Tout type de fichier — SafeCheck isolera le contenu côté backend.</div>
                        </div>
                        <label class="file-drop" id="fileDrop">
                            <div class="file-drop-icon-row">
                                <div class="file-drop-icon">⭳</div>
                                <div>
                                    <div class="file-drop-label">Glisse-dépose ou clique pour choisir un fichier</div>
                                    <div class="file-drop-hint">Formats connus : .png, .jpeg, .mp4, .mp3, .m4a, .avi, .txt — autres : “Inconnu”.</div>
                                </div>
                            </div>
                            <div class="file-selected" id="fileSelected">Aucun fichier sélectionné.</div>
                            <input type="file" id="fileInput">
                        </label>
                    </div>

                    <div class="actions-row">
                        <div class="actions-left">
                            <div class="latency-pill">
                                Latence étape 1 &lt; <span>50 ms</span>
                            </div>
                            <div class="latency-pill">
                                Étapes 2 &amp; 3 via <span>backend</span>
                            </div>
                        </div>
                        <div class="actions-right">
                            <button class="btn btn-ghost" id="clearBtn">
                                <span class="icon">⌫</span>
                                Clear
                            </button>
                            <button class="btn btn-primary" id="scanBtn">
                                <span class="icon">▶</span>
                                Scan
                            </button>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="results-panel">
                        <div class="results-header-row">
                            <div class="results-title">Résultats du scan</div>
                            <div class="input-hint" id="resultsHint">En attente de scan.</div>
                        </div>
                        <div class="results-body" id="resultsBody">
                            <div class="results-empty">
                                Aucun résultat pour l’instant. Lance un scan pour voir l’analyse détaillée (texte, fichier, overall).
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PANEL DROIT : LÉGENDE & ÉTAPES -->
        <section class="panel">
            <div class="panel-inner">
                <div class="panel-header">
                    <div class="panel-title-block">
                        <div class="panel-title">Risk map</div>
                        <div class="panel-subtitle">Légende des niveaux &amp; pipeline de scan</div>
                    </div>
                    <div class="panel-badge">827 : SafeCheck</div>
                </div>

                <div class="panel-section">
                    <div class="panel-section-label">Niveaux de risque</div>
                    <div class="risk-legend">
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot safe"></div>
                            <div>
                                <div class="risk-legend-label">Safe</div>
                                <div class="risk-legend-desc">Lien / fichier considéré sûr (ex : https://google.com).</div>
                            </div>
                        </div>
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot normal"></div>
                            <div>
                                <div class="risk-legend-label">Normal</div>
                                <div class="risk-legend-desc">HTTPS sans caractères trop aléatoires (ex : https://facebook.com).</div>
                            </div>
                        </div>
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot danger"></div>
                            <div>
                                <div class="risk-legend-label">Dangereux</div>
                                <div class="risk-legend-desc">Pas de https://, ou patterns suspects simples.</div>
                            </div>
                        </div>
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot virus"></div>
                            <div>
                                <div class="risk-legend-label">Virus / Malware</div>
                                <div class="risk-legend-desc">Liens très suspects (.xyz, .monster, encodages massifs, etc.).</div>
                            </div>
                        </div>
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot unknown-normal"></div>
                            <div>
                                <div class="risk-legend-label">Inconnu mais Normal</div>
                                <div class="risk-legend-desc">Extension / pattern inconnu, mais sans signaux forts.</div>
                            </div>
                        </div>
                        <div class="risk-legend-item">
                            <div class="risk-legend-dot unknown-suspect"></div>
                            <div>
                                <div class="risk-legend-label">Inconnu mais Suspect</div>
                                <div class="risk-legend-desc">Inconnu + signaux suspects — suppression après compte à rebours.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="scan-steps">
                        <div class="scan-steps-title">Pipeline de scan (3 étapes)</div>
                        <div class="scan-step">
                            <div class="scan-step-index">1.</div>
                            <div class="scan-step-body">
                                <strong>Scan du texte / extension</strong> — heuristique locale ultra rapide (&lt; 50 ms) :
                                <span>“https://”</span>, <span>“.com”</span>, <span>“.fr”</span>, extensions connues
                                (<span>.png</span>, <span>.jpeg</span>, <span>.mp4</span>, <span>.mp3</span>, <span>.m4a</span>, <span>.avi</span>, <span>.txt</span>).
                                Sinon : <strong>“Dangereux”</strong> ou <strong>“Inconnu mais Suspect”</strong>.
                            </div>
                        </div>
                        <div class="scan-step">
                            <div class="scan-step-index">2.</div>
                            <div class="scan-step-body">
                                <strong>Scan backend</strong> — le lien / fichier est visualisé côté serveur (antivirus / sandbox),
                                sans exposition directe pour l’utilisateur.
                            </div>
                        </div>
                        <div class="scan-step">
                            <div class="scan-step-index">3.</div>
                            <div class="scan-step-body">
                                <strong>Overall analyse</strong> — agrégation des signaux (texte, extension, backend) pour produire
                                un verdict global : <span>Safe</span>, <span>Normal</span>, <span>Dangereux</span>,
                                <span>Virus/Malware</span>, <span>Inconnu mais Normal</span>, <span>Inconnu mais Suspect</span>.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="backend-note">
                        <strong>Connexion backend réelle :</strong> cette interface est prête à appeler un endpoint
                        <code>/api/scan</code> (POST JSON) pour un scan <strong>non simulé</strong>.
                        Implémente ton antivirus / sandbox côté serveur, et renvoie un verdict structuré
                        (par ex. <code>{ riskLevel: "SAFE" | "NORMAL" | ... }</code>).
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <div class="app-footer-left">
            8 February 2027's Call — 827 : SafeCheck
        </div>
        <div class="app-footer-right">
            <span>Frontend :</span>
            <code>HTML + CSS + JS (monospace)</code>
            <span>Backend :</span>
            <code>Antivirus / Sandbox réel</code>
        </div>
    </footer>
</div>

<!-- POPUP DANGER / INCONNU-NORMAL -->
<div class="popup-overlay" id="popupDanger">
    <div class="popup" id="popupDangerBox">
        <div class="popup-header">
            <div class="popup-title-block">
                <div class="popup-title">Alerte de sécurité</div>
                <div class="popup-subtitle">Lien / fichier dangereux ou inconnu-normal</div>
            </div>
            <div class="popup-badge popup-badge-danger">Danger</div>
        </div>
        <div class="popup-body" id="popupDangerBody">
            <strong>Un élément a été classé comme “Dangereux” ou “Inconnu mais Normal”.</strong><br>
            Vérifie manuellement la source, l’expéditeur, et évite de cliquer si tu n’es pas sûr.
        </div>
        <div class="popup-footer">
            <div class="popup-footer-left">
                Ce contenu n’est pas supprimé automatiquement, mais son utilisation reste à tes risques.
            </div>
            <div class="popup-footer-right">
                <button class="popup-close" id="popupDangerClose">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- POPUP CRITIQUE / VIRUS / INCONNU-SUSPECT -->
<div class="popup-overlay" id="popupCritical">
    <div class="popup popup-critical" id="popupCriticalBox">
        <div class="popup-header">
            <div class="popup-title-block">
                <div class="popup-title">Alerte critique</div>
                <div class="popup-subtitle">Virus / Malware ou Inconnu mais Suspect</div>
            </div>
            <div class="popup-badge popup-badge-critical">Critique</div>
        </div>
        <div class="popup-body" id="popupCriticalBody">
            <strong>Un lien ou fichier a été classé comme “VIRUS/MALWARE” ou “Inconnu mais Suspect”.</strong><br>
            Il sera supprimé de SafeCheck après un compte à rebours de 30 secondes.<br><br>
            Recommandations :
            <ul>
                <li>Ne clique pas sur ce lien depuis d’autres applications.</li>
                <li>Supprime le fichier de ton appareil si tu ne l’attendais pas.</li>
                <li>Évite d’ouvrir des pièces jointes d’expéditeurs inconnus.</li>
            </ul>
        </div>
        <div class="popup-footer">
            <div class="popup-footer-left">
                <span class="popup-countdown" id="popupCountdown">Suppression dans 30 s...</span>
            </div>
            <div class="popup-footer-right">
                <button class="popup-close" id="popupCriticalClose">Fermer</button>
            </div>
        </div>
    </div>
</div>

<script>
/* ============================================================
   827 : SafeCheck — Frontend logique
   - Police de base : monospace
   - Titres : Inndam Extended
   - Étape 1 : heuristique locale (texte / extension)
   - Étapes 2 & 3 : appel backend /api/scan (à implémenter côté serveur)
   ============================================================ */

(function() {
    "use strict";

    // -----------------------------
    // DOM refs
    // -----------------------------
    const introOverlay = document.getElementById("introOverlay");
    const introSkip = document.getElementById("introSkip");

    const linkInput = document.getElementById("linkInput");
    const fileInput = document.getElementById("fileInput");
    const fileSelected = document.getElementById("fileSelected");
    const fileDrop = document.getElementById("fileDrop");

    const scanBtn = document.getElementById("scanBtn");
    const clearBtn = document.getElementById("clearBtn");

    const resultsBody = document.getElementById("resultsBody");
    const resultsHint = document.getElementById("resultsHint");

    const globalStatusChip = document.getElementById("globalStatusChip");
    const globalRiskLabel = document.getElementById("globalRiskLabel");

    const popupDanger = document.getElementById("popupDanger");
    const popupDangerClose = document.getElementById("popupDangerClose");
    const popupDangerBody = document.getElementById("popupDangerBody");

    const popupCritical = document.getElementById("popupCritical");
    const popupCriticalClose = document.getElementById("popupCriticalClose");
    const popupCriticalBody = document.getElementById("popupCriticalBody");
    const popupCountdown = document.getElementById("popupCountdown");

    // -----------------------------
    // Intro overlay
    // -----------------------------
    function hideIntro() {
        if (!introOverlay.classList.contains("hidden")) {
            introOverlay.classList.add("hidden");
        }
    }

    introSkip.addEventListener("click", hideIntro);
    setTimeout(hideIntro, 3200);

    // -----------------------------
    // File input
    // -----------------------------
    fileInput.addEventListener("change", function() {
        if (fileInput.files && fileInput.files.length > 0) {
            const f = fileInput.files[0];
            fileSelected.innerHTML = 'Fichier sélectionné : <strong>' + (f.name || "Sans nom") + "</strong>";
        } else {
            fileSelected.textContent = "Aucun fichier sélectionné.";
        }
    });

    // -----------------------------
    // Clear
    // -----------------------------
    clearBtn.addEventListener("click", function() {
        linkInput.value = "";
        fileInput.value = "";
        fileSelected.textContent = "Aucun fichier sélectionné.";
        resultsBody.innerHTML = '<div class="results-empty">Aucun résultat pour l’instant. Lance un scan pour voir l’analyse détaillée (texte, fichier, overall).</div>';
        resultsHint.textContent = "En attente de scan.";
        setGlobalRisk("PENDING");
    });

    // -----------------------------
    // Risk mapping
    // -----------------------------
    const RiskLevels = {
        SAFE: "SAFE",
        NORMAL: "NORMAL",
        DANGEROUS: "DANGEROUS",
        VIRUS: "VIRUS",
        UNKNOWN_NORMAL: "UNKNOWN_NORMAL",
        UNKNOWN_SUSPECT: "UNKNOWN_SUSPECT",
        PENDING: "PENDING"
    };

    function setGlobalRisk(level) {
        globalStatusChip.classList.remove("safe", "normal", "danger", "virus", "unknown-normal", "unknown-suspect");
        globalRiskLabel.classList.remove("safe", "normal", "danger", "virus", "unknown-normal", "unknown-suspect", "blink-red", "blink-orange");

        let label = "En attente";
        switch (level) {
            case RiskLevels.SAFE:
                globalStatusChip.classList.add("safe");
                globalRiskLabel.classList.add("safe");
                label = "Safe";
                break;
            case RiskLevels.NORMAL:
                globalStatusChip.classList.add("normal");
                globalRiskLabel.classList.add("normal");
                label = "Normal";
                break;
            case RiskLevels.DANGEROUS:
                globalStatusChip.classList.add("danger");
                globalRiskLabel.classList.add("danger");
                label = "Dangereux";
                break;
            case RiskLevels.VIRUS:
                globalStatusChip.classList.add("virus");
                globalRiskLabel.classList.add("virus", "blink-red");
                label = "VIRUS / MALWARE";
                break;
            case RiskLevels.UNKNOWN_NORMAL:
                globalStatusChip.classList.add("unknown-normal");
                globalRiskLabel.classList.add("unknown-normal");
                label = "Inconnu mais Normal";
                break;
            case RiskLevels.UNKNOWN_SUSPECT:
                globalStatusChip.classList.add("unknown-suspect");
                globalRiskLabel.classList.add("unknown-suspect", "blink-orange");
                label = "Inconnu mais Suspect";
                break;
            default:
                label = "En attente";
        }
        globalRiskLabel.textContent = label;
    }

    // -----------------------------
    // Heuristique locale (Étape 1)
    // -----------------------------
    function classifyLinkHeuristic(url) {
        const trimmed = (url || "").trim();
        if (!trimmed) return null;

        const lower = trimmed.toLowerCase();

        // Safe exemples explicites
        if (lower === "https://google.com" ||
            lower === "https://testsitefvc.my.canva.site/future-val-corp-fr-siteinvite") {
            return RiskLevels.SAFE;
        }

        // Normal : https:// + pas trop aléatoire
        const isHttps = lower.startsWith("https://");
        const hasRandomish = /[0-9a-z]{10,}/i.test(lower.replace(/https?:\/\//, ""));
        const suspiciousTlds = [
            ".xyz", ".monster", ".top", ".click", ".info"
        ];
        const suspiciousHosts = [
            "virus"
        ];
        const suspiciousShorteners = [
            "bit.ly/", "tinyurl.com/", "t.co/"
        ];

        const hasSuspiciousTld = suspiciousTlds.some(tld => lower.includes(tld));
        const hasSuspiciousHost = suspiciousHosts.some(h => lower.includes(h));
        const hasSuspiciousShortener = suspiciousShorteners.some(s => lower.includes(s));

        const encodedPattern = /%(20|3d|7b|7d|2f|3f|26)/ig;
        const encodedMatches = lower.match(encodedPattern);
        const encodedCount = encodedMatches ? encodedMatches.length : 0;
        const excessiveEncoding = encodedCount >= 5;

        if (!isHttps) {
            if (hasRandomish || hasSuspiciousTld || hasSuspiciousHost || hasSuspiciousShortener || excessiveEncoding) {
                return RiskLevels.VIRUS;
            }
            return RiskLevels.DANGEROUS;
        }

        if (hasSuspiciousTld || hasSuspiciousHost || hasSuspiciousShortener || excessiveEncoding || hasRandomish) {
            return RiskLevels.VIRUS;
        }

        // Normal par défaut si https:// sans signaux forts
        return RiskLevels.NORMAL;
    }

    function classifyFileHeuristic(file) {
        if (!file) return null;
        const name = (file.name || "").toLowerCase();
        const extMatch = name.match(/\.([a-z0-9]+)$/i);
        const ext = extMatch ? "." + extMatch[1] : "";

        const knownSafeExts = [".png", ".jpeg", ".jpg", ".mp4", ".mp3", ".m4a", ".avi", ".txt"];

        if (!ext) {
            return RiskLevels.UNKNOWN_SUSPECT;
        }

        if (knownSafeExts.includes(ext)) {
            return RiskLevels.UNKNOWN_NORMAL;
        }

        // Extension inconnue => suspect
        return RiskLevels.UNKNOWN_SUSPECT;
    }

    // -----------------------------
    // Backend call (Étapes 2 & 3)
    // -----------------------------
    async function callBackendScan(payload) {
        // NOTE :
        // Ici, on prépare l’appel à un backend réel.
        // Remplace l’URL /api/scan par ton endpoint.
        // Le backend doit renvoyer un JSON du type :
        // { riskLevel: "SAFE" | "NORMAL" | "DANGEROUS" | "VIRUS" | "UNKNOWN_NORMAL" | "UNKNOWN_SUSPECT", details: "...", ... }
        //
        // Pour respecter la demande “PAS SIMULÉ”, c’est ce backend qui doit faire
        // le vrai scan antivirus / sandbox.
        //
        // Ci-dessous, on garde un fallback minimal si le backend ne répond pas.

        try {
            const response = await fetch("/api/scan", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error("Backend HTTP " + response.status);
            }

            const data = await response.json();
            return data;
        } catch (e) {
            // Fallback : on renvoie null pour signaler l’absence de backend
            console.warn("Backend scan error / non disponible :", e);
            return null;
        }
    }

    // -----------------------------
    // Aggregation / overall risk
    // -----------------------------
    function aggregateRisk(localRisk, backendRisk) {
        // Priorité au backend si présent
        if (backendRisk && backendRisk.riskLevel && RiskLevels[backendRisk.riskLevel]) {
            return backendRisk.riskLevel;
        }

        // Sinon, on se base sur l’heuristique locale
        return localRisk || RiskLevels.PENDING;
    }

    // -----------------------------
    // Popups
    // -----------------------------
    let criticalCountdownTimer = null;
    let criticalCountdownValue = 30;

    function openDangerPopup(message) {
        popupDangerBody.innerHTML = message;
        popupDanger.classList.add("visible");
    }

    function closeDangerPopup() {
        popupDanger.classList.remove("visible");
    }

    popupDangerClose.addEventListener("click", closeDangerPopup);

    function openCriticalPopup(message, onDelete) {
        popupCriticalBody.innerHTML = message;
        popupCritical.classList.add("visible");
        criticalCountdownValue = 30;
        popupCountdown.textContent = "Suppression dans " + criticalCountdownValue + " s...";

        if (criticalCountdownTimer) {
            clearInterval(criticalCountdownTimer);
        }

        criticalCountdownTimer = setInterval(function() {
            criticalCountdownValue -= 1;
            if (criticalCountdownValue <= 0) {
                clearInterval(criticalCountdownTimer);
                criticalCountdownTimer = null;
                popupCountdown.textContent = "Suppression effectuée.";
                if (typeof onDelete === "function") {
                    onDelete();
                }
            } else {
                popupCountdown.textContent = "Suppression dans " + criticalCountdownValue + " s...";
            }
        }, 1000);
    }

    function closeCriticalPopup() {
        popupCritical.classList.remove("visible");
        if (criticalCountdownTimer) {
            clearInterval(criticalCountdownTimer);
            criticalCountdownTimer = null;
        }
    }

    popupCriticalClose.addEventListener("click", closeCriticalPopup);

    // -----------------------------
    // Résultats UI
    // -----------------------------
    function addResultItem(type, content, localRisk, backendRisk, overallRisk) {
        const item = document.createElement("div");
        item.className = "results-item";

        const header = document.createElement("div");
        header.className = "results-item-header";

        const label = document.createElement("div");
        label.className = "results-item-label";
        label.textContent = type === "link" ? "Lien analysé" : "Fichier analysé";

        const typeLabel = document.createElement("div");
        typeLabel.className = "results-item-type";
        typeLabel.textContent = type === "link" ? "TEXT / URL" : "FILE";

        header.appendChild(label);
        header.appendChild(typeLabel);

        const contentDiv = document.createElement("div");
        contentDiv.className = "results-item-content";
        contentDiv.textContent = content;

        const meta = document.createElement("div");
        meta.className = "results-item-meta";

        const localSpan = document.createElement("span");
        localSpan.innerHTML = "Étape 1 (local) : <strong>" + (localRisk || "N/A") + "</strong>";

        const backendSpan = document.createElement("span");
        backendSpan.innerHTML = "Étapes 2 &amp; 3 (backend) : <strong>" + (backendRisk && backendRisk.riskLevel ? backendRisk.riskLevel : "N/A") + "</strong>";

        const overallSpan = document.createElement("span");
        overallSpan.innerHTML = "Overall : <strong>" + (overallRisk || "N/A") + "</strong>";

        meta.appendChild(localSpan);
        meta.appendChild(backendSpan);
        meta.appendChild(overallSpan);

        item.appendChild(header);
        item.appendChild(contentDiv);
        item.appendChild(meta);

        resultsBody.appendChild(item);
    }

    // -----------------------------
    // Scan handler
    // -----------------------------
    scanBtn.addEventListener("click", async function() {
        const rawText = linkInput.value || "";
        const file = fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;

        const links = rawText
            .split(/\s+/)
            .map(s => s.trim())
            .filter(Boolean);

        if (links.length === 0 && !file) {
            resultsHint.textContent = "Aucun lien ni fichier fourni.";
            return;
        }

        resultsBody.innerHTML = "";
        resultsHint.textContent = "Scan en cours...";

        setGlobalRisk(RiskLevels.PENDING);
        scanBtn.disabled = true;

        // Étape 1 : heuristique locale (latence max 50 ms)
        const t0 = performance.now();

        const linkLocalRisks = links.map(classifyLinkHeuristic);
        const fileLocalRisk = classifyFileHeuristic(file);

        const t1 = performance.now();
        const latency = Math.round(t1 - t0);
        console.log("Étape 1 (heuristique locale) latency:", latency, "ms");

        // Préparation payload backend
        const payload = {
            links: links,
            fileMeta: file ? {
                name: file.name,
                size: file.size,
                type: file.type
            } : null
        };

        // Étapes 2 & 3 : backend
        const backendResult = await callBackendScan(payload);

        // On mappe les résultats backend par lien / fichier si le backend renvoie du détail
        // Format attendu (exemple) :
        // {
        //   riskLevel: "DANGEROUS",
        //   perLink: [{ url: "...", riskLevel: "SAFE" }, ...],
        //   file: { riskLevel: "UNKNOWN_SUSPECT" }
        // }
        const perLinkBackend = backendResult && Array.isArray(backendResult.perLink) ? backendResult.perLink : [];
        const fileBackend = backendResult && backendResult.file ? backendResult.file : null;

        // Agrégation & affichage
        let globalWorstRisk = RiskLevels.SAFE;

        function updateGlobalWorst(risk) {
            const order = [
                RiskLevels.SAFE,
                RiskLevels.NORMAL,
                RiskLevels.UNKNOWN_NORMAL,
                RiskLevels.DANGEROUS,
                RiskLevels.UNKNOWN_SUSPECT,
                RiskLevels.VIRUS
            ];
            if (!risk) return;
            if (order.indexOf(risk) > order.indexOf(globalWorstRisk)) {
                globalWorstRisk = risk;
            }
        }

        // Liens
        links.forEach((url, idx) => {
            const localRisk = linkLocalRisks[idx] || RiskLevels.DANGEROUS;
            const backendForLink = perLinkBackend.find(p => p.url === url) || null;
            const overallRisk = aggregateRisk(localRisk, backendForLink);

            updateGlobalWorst(overallRisk);

            addResultItem("link", url, localRisk, backendForLink, overallRisk);

            // Popups selon le risque
            if (overallRisk === RiskLevels.DANGEROUS || overallRisk === RiskLevels.UNKNOWN_NORMAL) {
                openDangerPopup(
                    '<strong>Un lien a été classé comme “' + (overallRisk === RiskLevels.DANGEROUS ? 'Dangereux' : 'Inconnu mais Normal') + '”.</strong><br>' +
                    'Lien : <code>' + url + '</code><br>' +
                    'Évite de l’ouvrir si tu n’es pas certain de sa source.'
                );
            } else if (overallRisk === RiskLevels.VIRUS || overallRisk === RiskLevels.UNKNOWN_SUSPECT) {
                openCriticalPopup(
                    '<strong>Un lien a été classé comme “' + (overallRisk === RiskLevels.VIRUS ? 'VIRUS/MALWARE' : 'Inconnu mais Suspect') + '”.</strong><br>' +
                    'Lien : <code>' + url + '</code><br>' +
                    'Il sera supprimé de SafeCheck après le compte à rebours.',
                    function() {
                        // Suppression logique : on efface le texte correspondant du champ
                        const current = linkInput.value || "";
                        const regex = new RegExp(url.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "g");
                        linkInput.value = current.replace(regex, "").trim();
                    }
                );
            }
        });

        // Fichier
        if (file) {
            const localRisk = fileLocalRisk || RiskLevels.UNKNOWN_SUSPECT;
            const overallRisk = aggregateRisk(localRisk, fileBackend);

            updateGlobalWorst(overallRisk);

            addResultItem("file", file.name, localRisk, fileBackend, overallRisk);

            if (overallRisk === RiskLevels.DANGEROUS || overallRisk === RiskLevels.UNKNOWN_NORMAL) {
                openDangerPopup(
                    '<strong>Un fichier a été classé comme “' + (overallRisk === RiskLevels.DANGEROUS ? 'Dangereux' : 'Inconnu mais Normal') + '”.</strong><br>' +
                    'Fichier : <code>' + file.name + '</code><br>' +
                    'Évite de l’ouvrir si tu n’es pas certain de sa source.'
                );
            } else if (overallRisk === RiskLevels.VIRUS || overallRisk === RiskLevels.UNKNOWN_SUSPECT) {
                openCriticalPopup(
                    '<strong>Un fichier a été classé comme “' + (overallRisk === RiskLevels.VIRUS ? 'VIRUS/MALWARE' : 'Inconnu mais Suspect') + '”.</strong><br>' +
                    'Fichier : <code>' + file.name + '</code><br>' +
                    'Il sera supprimé de SafeCheck après le compte à rebours.',
                    function() {
                        // Suppression logique : on efface le fichier du champ
                        fileInput.value = "";
                        fileSelected.textContent = "Aucun fichier sélectionné.";
                    }
                );
            }
        }

        // Mise à jour du risque global
        setGlobalRisk(globalWorstRisk);

        if (!backendResult) {
            resultsHint.textContent = "Scan terminé (backend non disponible — seul l’heuristique locale a été utilisée).";
        } else {
            resultsHint.textContent = "Scan terminé (backend + heuristique locale).";
        }

        scanBtn.disabled = false;
    });

})();
</script>

</body>
</html>
